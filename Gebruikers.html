<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gebruiker Aanpassen</title>
  </head>
  <body>


    
    
    
    <div class = "ShowUserInfo"> 
    <label for="userId">userId:</label>
    <input type="text" id="userId" name="userId" placeholder="Vul UserID in"><br><br>
    <button onclick="showUpdateUser()">Update user info</button>
    </div>
    <div id="UpdateUserTable" style="display: none;">

      <label for="firstName">First name:</label>
      <input type="text" id="firstname" name="firstname"><br><br>

      <label for="lastName">Last name:</label>
      <input type="text" id="lastname" name="lastname"><br><br>

      <label for="username">Username:</label>
      <input type="text" id="username" name="username"><br><br>

      <label for="password">Password:</label>
      <input type="password" id="password" name="password"><br><br>

      <label for="email">Email:</label>
      <input type="email" id="email" name="email"><br><br>

      <label for="dateOfBirth">Date of birth:</label>
      <input type="date" id="dateofBirth" name="dateofBirth"><br><br>

      <label for="uploads">Uploads:</label>
      <input type="text" id="uploads" name="uploads"><br><br>

      <label for="bio">Bio:</label>
      <textarea id="bio" name="bio"></textarea><br><br>

      <label for="dateCreate">Date created:</label>
      <input type="date" id="dateCreate" name="dateCreate"><br><br>

      <label for="profilePicture">Profile picture:</label>
      <input type="text" id="profilePicture" name="profilePicture"><br><br>

      <button onclick="updateUser()">Update user</button>
    </div>
    

  <script>
    function showUpdateUser() {
 
      var userId = document.getElementById("userId").value
      console.log(userId);

      var xhttp = new XMLHttpRequest();
       xhttp.onreadystatechange = function (){
        if (this.readyState == 4 && this.status == 200) { var response = JSON.parse(xhttp.responseText);
         console.log(response[userId]) }
         var geladenUser = response[userId]
        //  console.log(typeof geladenRecept)
         Object.entries(geladenUser).forEach(element => {
          const [key, value]=element
          console.log(key,value)
            try {
              document.getElementById(key).value = value
              console.log(element)
          } catch (error) {
              console.log(error)
          }
         });
        };
        xhttp.open("GET", "https://localhost:7042/api/User", true);
         xhttp.send();
      var UserForm = document.getElementById("UpdateUserTable");
      UpdateUserTable.style.display = "block";
    }


    function updateUser() {
  // Haal de gegevens van de gebruiker op uit de inputvelden
  var userId = document.getElementById("userId").value;
  var NewUser = {};

  // Check welke velden zijn ingevuld en voeg deze toe aan het veld-object
  if (document.getElementById("firstname").value.trim() !== "") {
    NewUser.firstname = document.getElementById("firstname").value;
  }
  if (document.getElementById("lastname").value.trim() !== "") {
    NewUser.lastname = document.getElementById("lastname").value;
  }
  if (document.getElementById("username").value.trim() !== "") {
    NewUser.username = document.getElementById("username").value;
  }
  if (document.getElementById("password").value.trim() !== "") {
    NewUser.password = document.getElementById("password").value;
  }
  if (document.getElementById("email").value.trim() !== "") {
    NewUser.email = document.getElementById("email").value;
  }
  if (document.getElementById("dateofBirth").value.trim() !== "") {
    NewUser.dateOfBirth = document.getElementById("dateofBirth").value;
  }
  if (document.getElementById("uploads").value.trim() !== "") {
    NewUser.uploads = document.getElementById("uploads").value;
  }
  if (document.getElementById("bio").value.trim() !== "") {
    NewUser.bio = document.getElementById("bio").value;
  }
  if (document.getElementById("dateCreate").value.trim() !== "") {
    NewUser.dateCreate = document.getElementById("dateCreate").value;
  }
  if (document.getElementById("profilePicture").value.trim() !== "") {
    NewUser.profilePicture = document.getElementById("profilePicture").value;
  }


 
  console.log(JSON.stringify(NewUser))

  // Stuur de gegevens naar de backend via de Fetch API
  fetch('https://localhost:7042/api/User/' + userId, {
    method: "PUT",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify(NewUser)
    
  })
  .then(response => {
    if (response.ok) {
      alert("Gebruikersgegevens bijgewerkt");
    } else {
      alert("Er is een fout opgetreden bij het bijwerken van de gebruikersgegevens");
    }
  })
  .catch(error => {
    console.error('Fout bij het bijwerken van de gebruikersgegevens:', error);
  });
}

 </script>   
  </body>
</html>

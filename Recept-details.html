<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Recept details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

</head>
<body>
<style>
    h2{
        font-size:18px;
        font-weight:bold;
        margin-bottom: 0px;
        text-align: left;
    }

    input[type=text-h1] {
        text-align: left;
        word-wrap: break-word;
        word-break: break-word;
        height: 80px;
        font-weight: bold;
        font-size:larger;
        margin-left: 0px;
        border-color: white;
    }
    textarea[type=text] {
        width: 250px;
        text-align: left;
        word-wrap: break-word;
        height: 65px;
        font-weight: initial;
        font-size:smaller;
        margin-left: 18px;
        border: 0px;
        border-color: white;
    }
    input[type=number] {
        width: 80px;
        text-align: center;
        word-wrap: break-word;
        word-break: break-all;
        height: 50px;
        font-weight: initial;
        font-size:smaller;
        margin-left: 18px;
        border: 0px;
        border-color: white;
    }

    div{
      border: 0px;
      border-color: white;
    }

    img {
    border-radius: 50%;
    }

    .dropdown-menu {
    left: auto !important;
    right: 0 !important;
}

    /* input{
      width: auto;
      height: auto;
      word-wrap: break-word;
      word-break: break-all;
      overflow-wrap: break-word;
    } */
</style>
<!-- Begin header -->
<body>
    <div class="container-fluid onze-header">
        <nav class="navbar navbar-expand" style="z-index:1">
            <div class="container-fluid">
                <a class="navbar-brand" href="index.html">
                    <img src="img/logo.png" class="img-fluid logo" alt="Recepten Database"/>
                </a>
            </div>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Recepten.html">Recepten</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            Recepten Bewerken
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="ReceptToevoegen.html">Toevoegen</a></li>
                            <li><a class="dropdown-item" href="Recept-aanpassen.html">Aanpassen</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            <i class="fa-solid fa-circle-user"></i>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="Gebruikers.html" style="position:relative;">Mijn Account</a></li>
                            <li><a class="dropdown-item" href="GebruikersAanmaken.html">Account aanmaken</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>
        <div class="header">
            <div class="search">
                <div class="input-group">
                    <span class="input-group-text"><i class="fa-solid fa-magnifying-glass"></i></span>
                    <input type="text" class="form-control" placeholder="Zoek recept..">
                </div>
            </div>
        </div>
    </div>


  
      <!-- BEGIN NESTING -->
      <div class="container text-left">
        <div class="row">
          <div class="col">
            <h1>
              <!-- Receptnaam -->
              <div class="mb">
                <input type="text-h1" class="form-control-plaintext" id="1-input" name="title" placeholder="title komt hier."disabled readonly>
              </div>

      <div class="container text-left">
        <div class="row">
          <div class="col-sm-6">
            <!-- <img src="./img/header.jpg" style="object-fit:cover; width:600px; height:600px"> -->
            <input type="image" id="8-input" style="object-fit:cover; width:600px; height:600px">
            <!-- Level 1: .col-sm-6 -->
              <div class="row">
                <div class="col-sm-4">
                  <br>
                  <img src="./img/young cap.jpeg" alt="profilepicture-admin" width="200" height="200">
                </div>
                <div class="col-sm">
                  <br><br>
                  Auteur:
                  <div class="mb-3">
                    Admin
                    <!-- <input type="text" class="form-control-plaintext" id="userId-input" name="userId" placeholder="userId wordt hier geladen."disabled readonly> -->
                  </div>
                  Gepubliceerd op:
                  <div class="mb-3">
                    <input type="datetime"type = "text" class="form-control-plaintext" id="11-input" name="dateCreate" placeholder="dateCreate wordt hier geladen."disabled readonly><br>
                  </div>
                  <!-- <br>
                  Laatst geupdate op: dag-maand-jaar -->
              </div>
            </div>
          </div>
          <div class="col-sm-6">
            <div class="row">
              <div class="col-2 col-sm-6">
                <!-- KOLOM 2 KOMT HIER -->
                <!-- Level 2: .col-8 .col-sm-6 -->
                <div class="row row-cols-1">
                  <div class="input-group col-sm-4">
                      <span class="input-group-text"><i class="fa form-control-plaintext" aria-hidden="true"></i>
                        <input type="number" class="fa form-control-plaintext" id="7-input" aria-label="Amount (to the nearest dollar)" disabled readonly>
                        <i class="fa fa-star"></i></span>
                    </div>
                                        
                    <div class="input-group col-sm-4">
                      <div class="input-group-prepend ">
                        <span class="input-group-text"><i class="fa form-control-plaintext" aria-hidden="true"></i>
                          <input type="number" class="fa form-control-plaintext" id="3-input" aria-label="Amount (to the nearest dollar)" disabled readonly>
                        min</span>
                      </div>
                      
                    </div>

                    <div class="input-group col-sm-4">
                      
                      <div class="col-sm-6"><h2>Barbecue</h2>
                        <textarea type="text" class="form-control-plaintext" id="6-input" name="bbqId-input" placeholder="bbqId komt hier."disabled readonly></textarea>
                      </div>
                    </div>

                    <div class="input-group col-sm-4">
                      <div class="col-sm-6"><h2>Dieet</h2>
                        <textarea type="text" class="form-control-plaintext" id="10-input" name="diet" placeholder="diet komt hier."disabled readonly></textarea>
                      </div>
                    </div>
                    <div id = "colgate" class="input-group col-sm-4">
                      
                    </div>
                    <div class="input-group col-sm-4">
                      <div class="col-sm-6"><h2>Kookgereedschap</h2>
                        <textarea type="text" class="form-control-plaintext" id="5-input" name="cookAttireId-input" placeholder="cookAttireId komt hier." disabled readonly></textarea>
                      </div>
                    </div>
                  </div>                
              </div>
              <div class="col-3 col-sm-5">
                <!-- KOLOM 3 KOMT HIER -->
                <!-- Level 2: .col-4 .col-sm-6 -->
                <div class="row row-cols-6">
                    <div class="input-group col-sm-6">
                      <div class="row"><h2>Introductie</h2>
                        <textarea readonly type = "text" class="form-control-plaintext" placeholder="intro komt hier" id="9-input" style="height: 200px" font="12px" disabled readonly></textarea>
                        <!-- <input type="text" class="form-control-plaintext" style="object-fit:contain; width:600px; height:auto" id="intro-input" name="intro" placeholder="Introductie komt hier."disabled readonly><br> -->
                      </div>
                      <!-- Bim, bam, beieren, de koster lust geen eieren. Wat lust hij dan? Spek in de pan. O, zoo'n lekkere koster dan! -->
                    </div>
                    <div class="input-group col-sm-6">
                      <div class="row"><h2>Bereiding</h2>
                        <textarea readonly type = "text" class="form-control-plaintext" placeholder="prepText komt hier" id="4-input" style="height: 600px" font="12px" disabled readonly></textarea>
                        <!-- <input type="textarea" rows="25" wrap="hard" class="form-control" id="prepText-input" name="prepText" placeholder="prepText komt hier."><br> -->
                      </div>
                  </div> 
              </div>
            </div>
          </div>
        </div>
      </div>

      <script>
        // VALIDATION
        // Example starter JavaScript for disabling form submissions if there are invalid fields
        console.log(sessionStorage.getItem("recipeId"))
        $(window).scroll(function () {
        var height = $(window).scrollTop();

        if (height > 450) {
            $("nav.navbar").addClass("nav-achtergrond");
        } else {
            $("nav.navbar").removeClass("nav-achtergrond");
        }
    });
    (() => {
      'use strict'
      // Fetch all the forms we want to apply custom Bootstrap validation styles to
      const forms = document.querySelectorAll('.needs-validation')
      // Loop over them and prevent submission
      Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
          if (!form.checkValidity()) {
            event.preventDefault()
            event.stopPropagation()
          }
          form.classList.add('was-validated')
        }, false)
      })
    })()
        // EINDE VALIDATION
        
        // COLAPSE
        async function showUpdateRecipec(){
          var ReceptIDc = sessionStorage.getItem('recipeId')
          console.log(ReceptIDc);
          //var receptID = parseInt(ReceptID);
          
          var adjustedReceptId = Number(ReceptIDc.replace("--2", ""));
          console.log(adjustedReceptId);
          //console.log(ReceptIDc)
          const reqc = new Request("https://localhost:7042/api/Recepten")
          const responsec = await fetch(reqc);
          const textDatac = await responsec.text();
          const jsonDatac = JSON.parse(textDatac);
          var bruikbaar = jsonDatac[adjustedReceptId];
          var soep = Object.keys(bruikbaar);
          var value = Object.values(bruikbaar);
          console.log(value)
          for (let i=0;i<soep.length;i++){
              console.log(i)
            try{  
              document.getElementById(i + "-input").value = value[i]
              if(i == 3) {
                value = value.replace("PT", "")             
                value = value.replace("M", "")
                document.getElementById(key + "-input").value = value;
              }

              if(i == 1) {
                value = value.replaceAll("$", "'")             
                //value = value.replace("M", "")
                document.getElementById(key + "-input").value = value;
              }

              if(i == 4) {
                //value = value.replace("$", "'")
                value = value.replace(/["]/g, '')             
                value = value.replaceAll('@', ',')
                value = value.replaceAll("&#39;", "'")
                console.log(value)
                document.getElementById(key + "-input").value = value;
              }

              if(i == 9) {
                value = value.replace(/["]/g, '')
                value = value.replaceAll("$", "'")             
                value = value.replaceAll("@", ",")
                document.getElementById(key + "-input").value = value;
              }
              if(i == 6) {
                document.getElementById(key + "-input").value = "Gas";
              }

              if (i == 8) {
                value = value.replace(/["]/g, '')
                console.log(value)
                document.getElementById(key + "-input").src = value          
              }

              if (i == 11) {
                var date = new Date(value)
                //console.log(value)
                document.getElementById(key + "-input").value = date;          
              }
            }
            catch (error) {
                  console.log(error);
                }
          }
          const req3 = new Request("https://localhost:7042/api/RecipeIngredient/recept/" + adjustedReceptId)
          //console.log(req2)
          const response3 = await fetch(req3);
          const textData3 = await response3.text();
          const jsonData3 = JSON.parse(textData3);
          console.log(jsonData3)
          colgate.innerHTML = "<h2>Ingredienten</h2>";
            for(var i=0;i<jsonData3.length; i++){
                colgate.innerHTML += `<textarea type="text" class="form-control-plaintext" id="`+ i +`-ing" name="ing" placeholder="` + i + `"disabled readonly>`+jsonData3[i].name+`</textarea>`
                console.log(i)
              }
        }
          
        // FILL RECIPE FORM
        async function showUpdateRecipe() {
          // Haal het formulier op
          var ReceptID = sessionStorage.getItem('recipeId')
          console.log(ReceptID);
          //var receptID = parseInt(ReceptID);
          
          var adjustedReceptId = Number(ReceptID.replace("--1", ""));
          console.log(adjustedReceptId);
          var xhttp = new XMLHttpRequest();
          xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
              var response = JSON.parse(xhttp.responseText);
              console.log(response[adjustedReceptId]);

              var geladenRecept = response[adjustedReceptId];
              Object.entries(geladenRecept).forEach(element => {
                var [key, value] = element;
                console.log(key, value);
                key=parseInt(key) 
                try {
                  document.getElementById(key + "-input").value = value;

                  if(key == 3) {
                    value = value.replace("PT", "")             
                    value = value.replace("M", "")
                    document.getElementById(key + "-input").value = value;
                  }

                  if(key == 1) {
                    value = value.replaceAll("$", "'")             
                    //value = value.replace("M", "")
                    document.getElementById(key + "-input").value = value;
                  }

                  if(key == 4) {
                    //value = value.replace("$", "'")
                    value = value.replace(/["]/g, '')             
                    value = value.replaceAll('@', ',')
                    value = value.replaceAll("&#39;", "'")
                    console.log(value)
                    document.getElementById(key + "-input").value = value;
                  }

                  if(key == 9) {
                    value = value.replace(/["]/g, '')
                    value = value.replaceAll("$", "'")             
                    value = value.replaceAll("@", ",")
                    document.getElementById(key + "-input").value = value;
                  }
                  if(key == 6) {
                    document.getElementById(key + "-input").value = "Gas";
                  }

                  if (key == 8) {
                    value = value.replace(/["]/g, '')
                    console.log(value)
                    document.getElementById(key + "-input").src = value          
                  }

                  if (key == 11) {
                    var date = new Date(value)
                    //console.log(value)
                    document.getElementById(key + "-input").value = date;          
                  }
                 
                  //console.log(element);
                } catch (error) {
                  console.log(error);
                }
              });
            }
          }
          xhttp.open("GET", "https://yc2304pythonbackend.azurewebsites.net/recipes", true);
          xhttp.send();

          var xhttpingrec = new XMLHttpRequest();
          xhttpingrec.onreadystatechange = async function(){
            if (this.readyState == 4 && this.status == 200) {

              var responseingrec = JSON.parse(xhttpingrec.responseText);
              for (var k=224; k<responseingrec.length; k++){
                responseingrec[k][1] = responseingrec[k][1] + 22 
                //console.log(responseingrec[k][1])
              }
              console.log(responseingrec)

              colgate.innerHTML = "<h2>Ingredienten</h2>";
              for(var i=0;i<responseingrec.length; i++){
                if (responseingrec[i][1] == adjustedReceptId){
                  //console.log(responseingrec[i])
                  colgate.innerHTML += `<textarea type="text" class="form-control-plaintext" id="`+ i +`-ing" name="ing" placeholder="` + i + `"disabled readonly>`
                  console.log(i)
                }
              }
              var karel = [];
              const req2 = new Request("https://yc2304pythonbackend.azurewebsites.net/ingredients")
              const response2 = await fetch(req2);
              const textData2 = await response2.text();
              const jsonData2 = JSON.parse(textData2);
              console.log(jsonData2)
              for(var j=0;j<responseingrec.length; j++){
                //console.log(j)
                if (responseingrec[j][1] == adjustedReceptId){
                  console.log(responseingrec[j][2])

                if (responseingrec[j][3] == null){
                    document.getElementById(j + "-ing").value = jsonData2[responseingrec[j][2]]["Name"];
                  }
                  else{
                  document.getElementById(j + "-ing").value = responseingrec[j][3] + responseingrec[j][4] + jsonData2[responseingrec[j][2]]["Name"];
                  }
                }
              }
            }
          }
        xhttpingrec.open("GET", "https://yc2304pythonbackend.azurewebsites.net/ingrec", true);
        xhttpingrec.send();
        var xhttping = new XMLHttpRequest();
        xhttping.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {
            var responseing = JSON.parse(xhttping.responseText);
            console.log(responseing[adjustedReceptId]);

            var geladenRecepting = responseing[adjustedReceptId];

          }
        };
        }

    
        function updateRecipe() {
          //Haal de gegevens van de gebruiker op uit de inputvelden
          var receptId = document.getElementById("id").value;
          var newRecept = {};
    
          //Check welke velden zijn ingevuld en voeg deze toe aan het veld-object
          if (document.getElementById("title-input").value.trim() !== "") {
            newRecept.title = document.getElementById("title-input").value;
          }
          if (document.getElementById("userId-input").value.trim() !== "") {
            newRecept.uploaderName = document.getElementById("userId-input").value;
          }
          if (document.getElementById("prepTime-input").value.trim() !== "") {
            newRecept.prepTime = document.getElementById("prepTime-input").value;
          }
          if (document.getElementById("prepText-input").value.trim() !== "") {
            newRecept.prepText = document.getElementById("prepText-input").value;
          }
          if (document.getElementById("intro-input").value.trim() !== "") {
            newRecept.intro = document.getElementById("intro-input").value;
          }
          if (document.getElementById("foto-input").value.trim() !== "") {
            newRecept.foto = foto.replace(/["]/g, '')

            newRecept.foto = document.getElementById("foto-input").src;
          }
          if (document.getElementById("bbqId-input").value.trim() !== "") {
            newRecept.bbqID = document.getElementById("bbqId-input").value;
          }
          if (document.getElementById("cookAttireId-input").value.trim() !== "") {
            newRecept.cookAttireId = document.getElementById("cookAttireId-input").value;
          }
          if (document.getElementById("rating-input").value.trim() !== "") {
            newRecept.rating = document.getElementById("rating-input").value;
          }
          if (document.getElementById("diet-input").value.trim() !== "") {
            newRecept.diet = document.getElementById("diet-input").value;
          }
          if (document.getElementById("dateCreate-input").value.trim() !== "") {
            newRecept.dateCreate = document.getElementById("dateCreate-input").value;
          }
          console.log(JSON.stringify(newRecept))
          console.log('https://yc2304pythonbackend.azurewebsites.net/recipes/' + receptId)
    
          // Stuur de gegevens naar de backend via de Fetch API
          fetch('https://yc2304pythonbackend.azurewebsites.net/recipes/' + receptId, {
            method: "PUT",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(newRecept)
          })
            .then(response => {
              if (response.ok) {
                alert("Recept bijgewerkt");
              } else {
                alert("Er is een fout opgetreden bij het bijwerken van het recept");
              }
            })
            .catch(error => {
              console.error('Fout bij het bijwerken van het recept:', error);
            });
        }
    
        function veldenVullen() {
          fetch('https://yc2304pythonbackend.azurewebsites.net/recipes/')
            .then(res => {
              return res.json();
            })
            .then(data => {
              console.log(data);
            })
            .catch(error => console.log(error)
            );
        }
    
        function verwijderRecept() {
          // Bouw de SQL-query
          var recipeId = document.getElementById("id").value;
          var query = "DELETE FROM table_name WHERE id = " + recipeId;
    
          // Verwijder de gebruiker met behulp van Fetch API
          fetch('https://yc2304pythonbackend.azurewebsites.net/recipes/' + recipeId, {
            method: "DELETE",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ query: query })
          })
            .then(response => {
              if (response.ok) {
                alert("Recept verwijderd");
              } else {
                alert("Er is een fout opgetreden bij het verwijderen van het recept");
              }
            })
            .catch(error => {
              console.error('Fout bij het verwijderen van het recept:', error);
            });
        }

      function showFoto() {
        var kolen = sessionStorage.getItem("recipeId");
        if (kolen[kolen.length - 1]==1){
          console.log(kolen)
          showUpdateRecipe()
        }
        else {
          console.log(true)
          showUpdateRecipec()
        }
      }
      window.onload = showFoto
      </script>
</body>
</html>